{"expireTime":9007200851888178000,"key":"transformer-remark-markdown-ast-a4b8f21f0984ad0fd1a615513c12562c-gatsby-remark-responsive-iframegatsby-remark-imagesgatsby-remark-external-linksgatsby-remark-header-custom-idsgatsby-remark-code-replsgatsby-remark-embed-snippetgatsby-remark-use-jsxgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"As we move closer to officially deprecating isMounted, it’s worth understanding why the function is an antipattern, and how to write code without the isMounted function.","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":170,"offset":170},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":170,"offset":170},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The primary use case for ","position":{"start":{"line":4,"column":1,"offset":172},"end":{"line":4,"column":26,"offset":197},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">isMounted()</code>","position":{"start":{"line":4,"column":26,"offset":197},"end":{"line":4,"column":39,"offset":210},"indent":[]}},{"type":"text","value":" is to avoid calling ","position":{"start":{"line":4,"column":39,"offset":210},"end":{"line":4,"column":60,"offset":231},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">setState()</code>","position":{"start":{"line":4,"column":60,"offset":231},"end":{"line":4,"column":72,"offset":243},"indent":[]}},{"type":"text","value":" after a component has unmounted, because calling ","position":{"start":{"line":4,"column":72,"offset":243},"end":{"line":4,"column":122,"offset":293},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">setState()</code>","position":{"start":{"line":4,"column":122,"offset":293},"end":{"line":4,"column":134,"offset":305},"indent":[]}},{"type":"text","value":" after a component has unmounted will emit a warning. The “setState warning” exists to help you catch bugs, because calling ","position":{"start":{"line":4,"column":134,"offset":305},"end":{"line":4,"column":258,"offset":429},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">setState()</code>","position":{"start":{"line":4,"column":258,"offset":429},"end":{"line":4,"column":270,"offset":441},"indent":[]}},{"type":"text","value":" on an unmounted component is an indication that your app/component has somehow failed to clean up properly. Specifically, calling ","position":{"start":{"line":4,"column":270,"offset":441},"end":{"line":4,"column":401,"offset":572},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">setState()</code>","position":{"start":{"line":4,"column":401,"offset":572},"end":{"line":4,"column":413,"offset":584},"indent":[]}},{"type":"text","value":" in an unmounted component means that your app is still holding a reference to the component after the component has been unmounted - which often indicates a memory leak!","position":{"start":{"line":4,"column":413,"offset":584},"end":{"line":4,"column":583,"offset":754},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":172},"end":{"line":4,"column":583,"offset":754},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To avoid the error message, people often add lines like this:","position":{"start":{"line":6,"column":1,"offset":756},"end":{"line":6,"column":62,"offset":817},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":756},"end":{"line":6,"column":62,"offset":817},"indent":[]}},{"type":"html","lang":"jsx","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isMounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// This is bad.</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":8,"column":1,"offset":819},"end":{"line":12,"column":4,"offset":894},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Checking ","position":{"start":{"line":14,"column":1,"offset":896},"end":{"line":14,"column":10,"offset":905},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">isMounted</code>","position":{"start":{"line":14,"column":10,"offset":905},"end":{"line":14,"column":21,"offset":916},"indent":[]}},{"type":"text","value":" before calling ","position":{"start":{"line":14,"column":21,"offset":916},"end":{"line":14,"column":37,"offset":932},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">setState()</code>","position":{"start":{"line":14,"column":37,"offset":932},"end":{"line":14,"column":49,"offset":944},"indent":[]}},{"type":"text","value":" does eliminate the warning, but it also defeats the purpose of the warning, since now you will never get the warning (even when you should!)","position":{"start":{"line":14,"column":49,"offset":944},"end":{"line":14,"column":190,"offset":1085},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":896},"end":{"line":14,"column":190,"offset":1085},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Other uses of ","position":{"start":{"line":16,"column":1,"offset":1087},"end":{"line":16,"column":15,"offset":1101},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">isMounted()</code>","position":{"start":{"line":16,"column":15,"offset":1101},"end":{"line":16,"column":28,"offset":1114},"indent":[]}},{"type":"text","value":" are similarly erroneous; using ","position":{"start":{"line":16,"column":28,"offset":1114},"end":{"line":16,"column":60,"offset":1146},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">isMounted()</code>","position":{"start":{"line":16,"column":60,"offset":1146},"end":{"line":16,"column":73,"offset":1159},"indent":[]}},{"type":"text","value":" is a code smell because the only reason you would check is because you think you might be holding a reference after the component has unmounted.","position":{"start":{"line":16,"column":73,"offset":1159},"end":{"line":16,"column":218,"offset":1304},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":1087},"end":{"line":16,"column":218,"offset":1304},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An easy migration strategy for anyone upgrading their code to avoid ","position":{"start":{"line":18,"column":1,"offset":1306},"end":{"line":18,"column":69,"offset":1374},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">isMounted()</code>","position":{"start":{"line":18,"column":69,"offset":1374},"end":{"line":18,"column":82,"offset":1387},"indent":[]}},{"type":"text","value":" is to track the mounted status yourself.  Just set a ","position":{"start":{"line":18,"column":82,"offset":1387},"end":{"line":18,"column":136,"offset":1441},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">_isMounted</code>","position":{"start":{"line":18,"column":136,"offset":1441},"end":{"line":18,"column":148,"offset":1453},"indent":[]}},{"type":"text","value":" property to true in ","position":{"start":{"line":18,"column":148,"offset":1453},"end":{"line":18,"column":169,"offset":1474},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">componentDidMount</code>","position":{"start":{"line":18,"column":169,"offset":1474},"end":{"line":18,"column":188,"offset":1493},"indent":[]}},{"type":"text","value":" and set it to false in ","position":{"start":{"line":18,"column":188,"offset":1493},"end":{"line":18,"column":212,"offset":1517},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">componentWillUnmount</code>","position":{"start":{"line":18,"column":212,"offset":1517},"end":{"line":18,"column":234,"offset":1539},"indent":[]}},{"type":"text","value":", and use this variable to check your component’s status.","position":{"start":{"line":18,"column":234,"offset":1539},"end":{"line":18,"column":291,"offset":1596},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":1306},"end":{"line":18,"column":291,"offset":1596},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An optimal solution would be to find places where ","position":{"start":{"line":20,"column":1,"offset":1598},"end":{"line":20,"column":51,"offset":1648},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">setState()</code>","position":{"start":{"line":20,"column":51,"offset":1648},"end":{"line":20,"column":63,"offset":1660},"indent":[]}},{"type":"text","value":" might be called after a component has unmounted, and fix them. Such situations most commonly occur due to callbacks, when a component is waiting for some data and gets unmounted before the data arrives. Ideally, any callbacks should be canceled in ","position":{"start":{"line":20,"column":63,"offset":1660},"end":{"line":20,"column":312,"offset":1909},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">componentWillUnmount</code>","position":{"start":{"line":20,"column":312,"offset":1909},"end":{"line":20,"column":334,"offset":1931},"indent":[]}},{"type":"text","value":", prior to unmounting.","position":{"start":{"line":20,"column":334,"offset":1931},"end":{"line":20,"column":356,"offset":1953},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":1598},"end":{"line":20,"column":356,"offset":1953},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For instance, if you are using a Flux store in your component, you must unsubscribe in ","position":{"start":{"line":22,"column":1,"offset":1955},"end":{"line":22,"column":88,"offset":2042},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">componentWillUnmount</code>","position":{"start":{"line":22,"column":88,"offset":2042},"end":{"line":22,"column":110,"offset":2064},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":22,"column":110,"offset":2064},"end":{"line":22,"column":111,"offset":2065},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":1955},"end":{"line":22,"column":111,"offset":2065},"indent":[]}},{"type":"html","lang":"jsx{9}","meta":null,"value":"<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    mydatastore<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    mydatastore<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":24,"column":1,"offset":2067},"end":{"line":36,"column":4,"offset":2285},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If you use ES6 promises, you may need to wrap your promise in order to make it cancelable.","position":{"start":{"line":38,"column":1,"offset":2287},"end":{"line":38,"column":91,"offset":2377},"indent":[]}}],"position":{"start":{"line":38,"column":1,"offset":2287},"end":{"line":38,"column":91,"offset":2377},"indent":[]}},{"type":"html","lang":"jsx","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">const</span> cancelablePromise <span class=\"token operator\">=</span> <span class=\"token function\">makeCancelable</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span> <span class=\"token operator\">=></span> component<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncancelablePromise\n  <span class=\"token punctuation\">.</span>promise\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resolved'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reason</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'isCanceled'</span><span class=\"token punctuation\">,</span> reason<span class=\"token punctuation\">.</span>isCanceled<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncancelablePromise<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Cancel the promise</span></code></pre></div>","position":{"start":{"line":40,"column":1,"offset":2379},"end":{"line":51,"column":4,"offset":2667},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Where ","position":{"start":{"line":53,"column":1,"offset":2669},"end":{"line":53,"column":7,"offset":2675},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">makeCancelable</code>","position":{"start":{"line":53,"column":7,"offset":2675},"end":{"line":53,"column":23,"offset":2691},"indent":[]}},{"type":"text","value":" was originally ","position":{"start":{"line":53,"column":23,"offset":2691},"end":{"line":53,"column":39,"offset":2707},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/facebook/react/issues/5465#issuecomment-157888325","children":[{"type":"text","value":"defined by @istarkov","position":{"start":{"line":53,"column":40,"offset":2708},"end":{"line":53,"column":60,"offset":2728},"indent":[]}}],"position":{"start":{"line":53,"column":39,"offset":2707},"end":{"line":53,"column":131,"offset":2799},"indent":[]},"data":{"hProperties":{"target":"_blank","rel":"nofollow noopener noreferrer"}}},{"type":"text","value":" as:","position":{"start":{"line":53,"column":131,"offset":2799},"end":{"line":53,"column":135,"offset":2803},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":2669},"end":{"line":53,"column":135,"offset":2803},"indent":[]}},{"type":"html","lang":"jsx","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeCancelable</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">promise</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> hasCanceled_ <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> wrappedPromise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    promise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> hasCanceled_ <span class=\"token operator\">?</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>isCanceled<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> hasCanceled_ <span class=\"token operator\">?</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>isCanceled<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    promise<span class=\"token operator\">:</span> wrappedPromise<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasCanceled_ <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>","position":{"start":{"line":55,"column":1,"offset":2805},"end":{"line":73,"column":4,"offset":3214},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"As an added bonus for getting your code cleaned up early, getting rid of ","position":{"start":{"line":75,"column":1,"offset":3216},"end":{"line":75,"column":74,"offset":3289},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">isMounted()</code>","position":{"start":{"line":75,"column":74,"offset":3289},"end":{"line":75,"column":87,"offset":3302},"indent":[]}},{"type":"text","value":" makes it one step easier for you to upgrade to ES6 classes, where using ","position":{"start":{"line":75,"column":87,"offset":3302},"end":{"line":75,"column":160,"offset":3375},"indent":[]}},{"type":"html","value":"<code class=\"gatsby-code-text\">isMounted()</code>","position":{"start":{"line":75,"column":160,"offset":3375},"end":{"line":75,"column":173,"offset":3388},"indent":[]}},{"type":"text","value":" is already prohibited.  Happy coding!","position":{"start":{"line":75,"column":173,"offset":3388},"end":{"line":75,"column":211,"offset":3426},"indent":[]}}],"position":{"start":{"line":75,"column":1,"offset":3216},"end":{"line":75,"column":211,"offset":3426},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":76,"column":1,"offset":3427}}}}